-- Tạo database
CREATE DATABASE BookStoreDB_Optimized;
GO

-- Sử dụng database
USE BookStoreDB_Optimized;
GO

-- Tạo bảng Roles
CREATE TABLE Roles (
    RoleID INT PRIMARY KEY IDENTITY(1,1),
    RoleName NVARCHAR(20) UNIQUE NOT NULL,
    Description NVARCHAR(100)
);

-- Tạo bảng Users
CREATE TABLE Users (
    UserID INT PRIMARY KEY IDENTITY(1,1),
    RoleID INT,
    Username NVARCHAR(50) UNIQUE NOT NULL,
    Password NVARCHAR(100) NOT NULL,
    FullName NVARCHAR(100),
    Email NVARCHAR(100) UNIQUE,
    Address NVARCHAR(200),
    CreatedAt DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (RoleID) REFERENCES Roles(RoleID)
);

-- Tạo bảng Categories
CREATE TABLE Categories (
    CategoryID INT PRIMARY KEY IDENTITY(1,1),
    CategoryName NVARCHAR(50) UNIQUE NOT NULL,
    Description NVARCHAR(200)
);

-- Tạo bảng Products
CREATE TABLE Products (
    ProductID INT PRIMARY KEY IDENTITY(1,1),
    CategoryID INT,
    Title NVARCHAR(100) NOT NULL,
    Author NVARCHAR(100),
    Price DECIMAL(18,2) NOT NULL,
    Description NVARCHAR(500),
    Stock INT DEFAULT 0,
    ImageURL NVARCHAR(200),
    FOREIGN KEY (CategoryID) REFERENCES Categories(CategoryID)
);

-- Tạo bảng Orders
CREATE TABLE Orders (
    OrderID INT PRIMARY KEY IDENTITY(1,1),
    UserID INT,
    OrderDate DATETIME DEFAULT GETDATE(),
    TotalAmount DECIMAL(18,2) NOT NULL,
    Status NVARCHAR(20) DEFAULT 'Chờ xử lý',
    ShippingAddress NVARCHAR(200),
    PaymentMethod NVARCHAR(50),
    FOREIGN KEY (UserID) REFERENCES Users(UserID)
);

-- Tạo bảng OrderDetails
CREATE TABLE OrderDetails (
    OrderDetailID INT PRIMARY KEY IDENTITY(1,1),
    OrderID INT,
    ProductID INT,
    Quantity INT NOT NULL,
    UnitPrice DECIMAL(18,2) NOT NULL,
    FOREIGN KEY (OrderID) REFERENCES Orders(OrderID),
    FOREIGN KEY (ProductID) REFERENCES Products(ProductID)
);

-- Tạo bảng Carts
CREATE TABLE Carts (
    CartID INT PRIMARY KEY IDENTITY(1,1),
    UserID INT,
    ProductID INT,
    Quantity INT NOT NULL,
    AddedDate DATETIME DEFAULT GETDATE(),
    FOREIGN KEY (UserID) REFERENCES Users(UserID),
    FOREIGN KEY (ProductID) REFERENCES Products(ProductID)
);

-- Thêm dữ liệu mẫu
INSERT INTO Roles (RoleName, Description)
VALUES ('Admin', 'Quản trị viên toàn quyền'),
       ('Customer', 'Khách hàng thông thường');

INSERT INTO Users (RoleID, Username, Password, FullName, Email, Address)
VALUES (1, 'admin', 'admin123', 'Quản trị viên', 'admin@example.com', '123 Đường ABC'),
       (2, 'user1', 'user123', 'Nguyễn Văn A', 'user1@example.com', '456 Đường XYZ');

INSERT INTO Categories (CategoryName, Description)
VALUES ('Văn học', 'Sách văn học Việt Nam và thế giới'),
       ('Khoa học', 'Sách khoa học phổ thông');

INSERT INTO Products (CategoryID, Title, Author, Price, Description, Stock)
VALUES (1, 'Dế Mèn Phiêu Lưu Ký', 'Tô Hoài', 50000, 'Tác phẩm văn học thiếu nhi nổi tiếng', 100),
       (2, 'Vũ Trụ Trong Một Hạt Cát', 'Stephen Hawking', 150000, 'Sách khoa học về vũ trụ', 50);